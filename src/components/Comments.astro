---
/**
 * Giscus Comments Component
 * Uses GitHub Discussions for comments
 * 
 * Setup:
 * 1. Enable GitHub Discussions on your repo
 * 2. Install Giscus app: https://github.com/apps/giscus
 * 3. Configure at https://giscus.app and update the data attributes below
 */

// Get these values from https://giscus.app after configuration
const repo = import.meta.env.PUBLIC_GISCUS_REPO || 'username/repo';
const repoId = import.meta.env.PUBLIC_GISCUS_REPO_ID || '';
const category = import.meta.env.PUBLIC_GISCUS_CATEGORY || 'Announcements';
const categoryId = import.meta.env.PUBLIC_GISCUS_CATEGORY_ID || '';
---

<section class="mt-16 pt-8 border-t border-gray-200 dark:border-gray-700">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-6 flex items-center gap-3">
        <svg class="w-6 h-6 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
        </svg>
        Comments
    </h2>
    
    <div id="giscus-container" class="giscus"></div>
</section>

<script>
    // Dynamically load Giscus with theme matching
    function loadGiscus() {
        const container = document.getElementById('giscus-container');
        if (!container) return;
        
        // Check current theme
        const isDark = document.documentElement.classList.contains('dark');
        const theme = isDark ? 'dark_dimmed' : 'light';
        
        const script = document.createElement('script');
        script.src = 'https://giscus.app/client.js';
        script.setAttribute('data-repo', 'REPLACE_WITH_YOUR_REPO');
        script.setAttribute('data-repo-id', 'REPLACE_WITH_YOUR_REPO_ID');
        script.setAttribute('data-category', 'Announcements');
        script.setAttribute('data-category-id', 'REPLACE_WITH_YOUR_CATEGORY_ID');
        script.setAttribute('data-mapping', 'pathname');
        script.setAttribute('data-strict', '0');
        script.setAttribute('data-reactions-enabled', '1');
        script.setAttribute('data-emit-metadata', '0');
        script.setAttribute('data-input-position', 'top');
        script.setAttribute('data-theme', theme);
        script.setAttribute('data-lang', 'en');
        script.setAttribute('data-loading', 'lazy');
        script.crossOrigin = 'anonymous';
        script.async = true;
        
        container.appendChild(script);
    }
    
    // Load on page load
    loadGiscus();
    
    // Update theme when it changes
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.attributeName === 'class') {
                const iframe = document.querySelector('.giscus-frame');
                if (iframe) {
                    const isDark = document.documentElement.classList.contains('dark');
                    const theme = isDark ? 'dark_dimmed' : 'light';
                    iframe.contentWindow?.postMessage(
                        { giscus: { setConfig: { theme } } },
                        'https://giscus.app'
                    );
                }
            }
        });
    });
    
    observer.observe(document.documentElement, { attributes: true });
</script>
